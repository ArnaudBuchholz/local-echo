var LocalEchoController;(()=>{"use strict";var t={121:(t,r,e)=>{e(151),r.parse=e(38)},38:t=>{for(var r="(?:"+["\\|\\|","\\&\\&",";;","\\|\\&","\\<\\(","\\<\\<\\<",">>",">\\&","<\\&","[&;()|<>]"].join("|")+")",e=new RegExp("^"+r+"$"),i="|&;()<> \\t",n=/^#$/,s="",o=0;o<4;o++)s+=(4294967296*Math.random()).toString(16);var u=new RegExp("^"+s);t.exports=function(t,o,a){var h=function(t,o,u){u||(u={});var a=u.escape||"\\",h=new RegExp(["("+r+")","((\\"+a+"['\""+i+"]|[^\\s'\""+i+"])+|\"((\\\\\"|[^\"])*?)\"|'((\\\\'|[^'])*?)')+"].join("|"),"g"),l=function(t,r){for(var e,i=r.lastIndex,n=[];e=r.exec(t);)n.push(e),r.lastIndex===e.index&&(r.lastIndex+=1);return r.lastIndex=i,n}(t,h);if(0===l.length)return[];o||(o={});var c=!1;return l.map((function(r){var i=r[0];if(i&&!c){if(e.test(i))return{op:i};var u,h=!1,l=!1,p="",f=!1;for(u=0;u<i.length;u++){var v=i.charAt(u);if(f=f||!h&&("*"===v||"?"===v),l)p+=v,l=!1;else if(h)v===h?h=!1:"'"==h?p+=v:v===a?(u+=1,p+='"'===(v=i.charAt(u))||v===a||"$"===v?v:a+v):p+="$"===v?d():v;else if('"'===v||"'"===v)h=v;else{if(e.test(v))return{op:i};if(n.test(v)){c=!0;var m={comment:t.slice(r.index+u+1)};return p.length?[p,m]:[m]}v===a?l=!0:p+="$"===v?d():v}}return f?{op:"glob",pattern:p}:p}function d(){var t,r;u+=1;var e=i.charAt(u);if("{"===e){if(u+=1,"}"===i.charAt(u))throw new Error("Bad substitution: "+i.slice(u-2,u+1));if((t=i.indexOf("}",u))<0)throw new Error("Bad substitution: "+i.slice(u));r=i.slice(u,t),u=t}else if(/[*@#?$!_-]/.test(e))r=e,u+=1;else{var n=i.slice(u);(t=n.match(/[^\w\d_]/))?(r=n.slice(0,t.index),u+=t.index-1):(r=n,u=i.length)}return function(t,r,e){var i="function"==typeof t?t(e):t[e];return void 0===i&&""!=e?i="":void 0===i&&(i="$"),"object"==typeof i?""+s+JSON.stringify(i)+s:""+i}(o,0,r)}})).reduce((function(t,r){return void 0===r?t:t.concat(r)}),[])}(t,o,a);return"function"!=typeof o?h:h.reduce((function(t,r){if("object"==typeof r)return t.concat(r);var e=r.split(RegExp("("+s+".*?"+s+")","g"));return 1===e.length?t.concat(e[0]):t.concat(e.filter(Boolean).map((function(t){return u.test(t)?JSON.parse(t.split(s)[1]):t})))}),[])}},151:t=>{t.exports=function(t){return t.map((function(t){return t&&"object"==typeof t?t.op.replace(/(.)/g,"\\$1"):/["\s]/.test(t)&&!/'/.test(t)?"'"+t.replace(/(['\\])/g,"\\$1")+"'":/["'\s]/.test(t)?'"'+t.replace(/(["\\$`!])/g,"\\$1")+'"':String(t).replace(/([A-Za-z]:)?([#!"$&'()*,:;<=>?@[\\\]^`{|}])/g,"$1\\$2")})).join(" ")}}},r={};function e(i){var n=r[i];if(void 0!==n)return n.exports;var s=r[i]={exports:{}};return t[i](s,s.exports,e),s.exports}e.d=(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var i={};(()=>{function t(r){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(r)}function r(r,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,(void 0,s=function(r,e){if("object"!==t(r)||null===r)return r;var i=r[Symbol.toPrimitive];if(void 0!==i){var n=i.call(r,"string");if("object"!==t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}(n.key),"symbol"===t(s)?s:String(s)),n)}var s}e.d(i,{default:()=>_});var n=function(){function t(r){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.size=r,this.entries=[],this.cursor=0}var e,i;return e=t,(i=[{key:"push",value:function(t){""!==t.trim()&&t!=this.entries[this.entries.length-1]&&(this.entries.push(t),this.entries.length>this.size&&this.entries.shift(),this.cursor=this.entries.length)}},{key:"rewind",value:function(){this.cursor=this.entries.length}},{key:"getPrevious",value:function(){var t=Math.max(0,this.cursor-1);return this.cursor=t,this.entries[t]}},{key:"getNext",value:function(){var t=Math.min(this.entries.length,this.cursor+1);return this.cursor=t,this.entries[t]}}])&&r(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),s=e(121);function o(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,i=new Array(r);e<r;e++)i[e]=t[e];return i}function u(t){return t.replace(/\x1B\[([0-9]{1,2}(;[0-9]{1,2})?)?[m|K]/g,"")}function a(t){for(var r,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],n=/\w+/g;r=n.exec(t);)e?i.push(r.index):i.push(r.index+r[0].length);return i}function h(t,r){var e=a(t,!0).reverse().find((function(t){return t<r}));return null==e?0:e}function l(t){for(var r=0,e=0;e<t.length;++e){var i=t.charAt(e);/[\u200B-\u200D\uFEFF]/g.test(i)||/[\u0591-\u05F4\uFB1D-\uFBF4]/g.test(i)?r+=0:/[\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u31FF\u3200-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u33FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]/g.test(i)?r+=2:r+=1}return r}function c(t,r,e){var i=t;t=u(t),r-=i.length-t.length;for(var n=0,s=0,o=0;o<r;++o){var a=t.charAt(o);("\n"==a||(s+=l(a))>e)&&(s=0,n+=1)}return{row:n,col:s}}function p(t,r){return c(t,t.length,r).row+1}function f(t){return null!=t.match(/[^\\][ \t]$/m)}function v(t){return""===t.trim()||f(t)?"":(0,s.parse)(t).pop()||""}function m(t,r){if(t.length>=r[0].length)return t;var e=t;t+=r[0].slice(t.length,t.length+1);for(var i=0;i<r.length;i++){if(!r[i].startsWith(e))return null;if(!r[i].startsWith(t))return e}return m(t,r)}function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function y(t,r){for(var e=0;e<r.length;e++){var i=r[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,r){if("object"!==d(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!==d(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===d(n)?n:String(n)),i)}var n}var g=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.term=r,this._handleTermData=this.handleTermData.bind(this),this._handleTermResize=this.handleTermResize.bind(this),this.history=new n(e.historySize||10),this.maxAutocompleteEntries=e.maxAutocompleteEntries||100,this._autocompleteHandlers=[],this._active=!1,this._input="",this._cursor=0,this._activePrompt=null,this._activeCharPrompt=null,this._termSize={cols:0,rows:0},this._disposables=[],r&&(r.loadAddon?r.loadAddon(this):this.attach()),String.prototype.__defineGetter__("width",(function(){return l(this)}))}var r,e;return r=t,e=[{key:"activate",value:function(t){this.term=t,this.attach()}},{key:"dispose",value:function(){this.detach()}},{key:"detach",value:function(){this.term.off?(this.term.off("data",this._handleTermData),this.term.off("resize",this._handleTermResize)):(this._disposables.forEach((function(t){return t.dispose()})),this._disposables=[])}},{key:"attach",value:function(){this.term.on?(this.term.on("data",this._handleTermData),this.term.on("resize",this._handleTermResize)):(this._disposables.push(this.term.onData(this._handleTermData)),this._disposables.push(this.term.onResize(this._handleTermResize))),this._termSize={cols:this.term.cols,rows:this.term.rows}}},{key:"addAutocompleteHandler",value:function(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),i=1;i<r;i++)e[i-1]=arguments[i];this._autocompleteHandlers.push({fn:t,args:e})}},{key:"removeAutocompleteHandler",value:function(t){var r=this._autocompleteHandlers.findIndex((function(r){return r.fn===t}));-1!==r&&this._autocompleteHandlers.splice(r,1)}},{key:"read",value:function(t){var r=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"> ";return new Promise((function(i,n){r.term.write(t),r._activePrompt={prompt:t,continuationPrompt:e,resolve:i,reject:n},r._input="",r._cursor=0,r._active=!0}))}},{key:"readChar",value:function(t){var r=this;return new Promise((function(e,i){r.term.write(t),r._activeCharPrompt={prompt:t,resolve:e,reject:i}}))}},{key:"abortRead",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"aborted";null==this._activePrompt&&null==this._activeCharPrompt||this.term.write("\r\n"),null!=this._activePrompt&&(this._activePrompt.reject(t),this._activePrompt=null),null!=this._activeCharPrompt&&(this._activeCharPrompt.reject(t),this._activeCharPrompt=null),this._active=!1}},{key:"println",value:function(t){this.print(t+"\n")}},{key:"print",value:function(t){var r=t.replace(/[\r\n]+/g,"\n");this.term.write(r.replace(/\n/g,"\r\n"))}},{key:"printWide",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0==t.length)return this.println("");for(var e=(t=t.map(u)).reduce((function(t,r){return Math.max(t,r.width)}),0)+r,i=Math.floor(this._termSize.cols/e),n=Math.ceil(t.width/i),s=0,o=0;o<n;++o){for(var a="",h=0;h<i;++h)if(s<t.width){var l=t[s++];a+=l+=" ".repeat(e-l.width)}this.println(a)}}},{key:"applyPrompts",value:function(t){var r=(this._activePrompt||{}).prompt||"",e=(this._activePrompt||{}).continuationPrompt||"";return r+t.replace(/\n/g,"\n"+e)}},{key:"applyPromptOffset",value:function(t,r){return this.applyPrompts(t.substring(0,r)).length}},{key:"clearInput",value:function(){for(var t=this.applyPrompts(this._input),r=p(t,this._termSize.cols),e=c(t,this.applyPromptOffset(this._input,this._cursor),this._termSize.cols),i=(e.col,r-e.row-1),n=0;n<i;++n)this.term.write("[E");for(this.term.write("\r[K"),n=1;n<r;++n)this.term.write("[F[K")}},{key:"setInput",value:function(t){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.clearInput();var r=this.applyPrompts(t);this.print(r),this._cursor>t.length&&(this._cursor=t.length);var e=this.applyPromptOffset(t,this._cursor),i=p(r,this._termSize.cols),n=c(r,e,this._termSize.cols),s=n.col,o=i-n.row-1;this.term.write("\r");for(var u=0;u<o;++u)this.term.write("[F");for(u=0;u<s;++u)this.term.write("[C");this._input=t}},{key:"printAndRestartPrompt",value:function(t){var r=this,e=this._cursor;this.setCursor(this._input.length),this.term.write("\r\n");var i=function(){r._cursor=e,r.setInput(r._input)},n=t();null==n?i():n.then(i)}},{key:"setCursor",value:function(t){t<0&&(t=0),t>this._input.length&&(t=this._input.length);var r=this.applyPrompts(this._input),e=(p(r,this._termSize.cols),c(r,this.applyPromptOffset(this._input,this._cursor),this._termSize.cols)),i=e.col,n=e.row,s=c(r,this.applyPromptOffset(this._input,t),this._termSize.cols),o=s.col,u=s.row;if(u>n)for(var a=n;a<u;++a)this.term.write("[B");else for(var h=u;h<n;++h)this.term.write("[A");if(o>i)for(var l=i;l<o;++l)this.term.write("[C");else for(var f=o;f<i;++f)this.term.write("[D");this._cursor=t}},{key:"handleCursorMove",value:function(t){if(t>0){var r=Math.min(t,this._input.length-this._cursor);this.setCursor(this._cursor+r)}else if(t<0){var e=Math.max(t,-this._cursor);this.setCursor(this._cursor+e)}}},{key:"handleCursorErase",value:function(t){var r=this._cursor,e=this._input;if(t){if(r<=0)return;var i=e.substring(0,r-1)+e.substring(r);this.clearInput(),this._cursor-=1,this.setInput(i,!1)}else{var n=e.substring(0,r)+e.substring(r+1);this.setInput(n)}}},{key:"handleCursorInsert",value:function(t){var r=this._cursor,e=this._input,i=e.substring(0,r)+t+e.substring(r);this._cursor+=t.length,this.setInput(i)}},{key:"handleReadComplete",value:function(){this.history&&this.history.push(this._input),this._activePrompt&&(this._activePrompt.resolve(this._input),this._activePrompt=null),this.term.write("\r\n"),this._active=!1}},{key:"handleTermResize",value:function(t){var r=t.rows,e=t.cols;this.clearInput(),this._termSize={cols:e,rows:r},this.setInput(this._input,!1)}},{key:"handleTermData",value:function(t){var r=this;if(this._active){if(null!=this._activeCharPrompt)return this._activeCharPrompt.resolve(t),this._activeCharPrompt=null,void this.term.write("\r\n");if(t.length>3&&27!==t.charCodeAt(0)){var e=t.replace(/[\r\n]+/g,"\r");Array.from(e).forEach((function(t){return r.handleData(t)}))}else this.handleData(t)}}},{key:"handleData",value:function(t){var r=this;if(this._active){var e,i,n,u,l=t.charCodeAt(0);if(27==l)switch(t.substring(1)){case"[A":if(this.history){var c=this.history.getPrevious();c&&(this.setInput(c),this.setCursor(c.length))}break;case"[B":if(this.history){var p=this.history.getNext();p||(p=""),this.setInput(p),this.setCursor(p.length)}break;case"[D":this.handleCursorMove(-1);break;case"[C":this.handleCursorMove(1);break;case"[3~":this.handleCursorErase(!1);break;case"[F":this.setCursor(this._input.length);break;case"[H":this.setCursor(0);break;case"b":null!=(e=h(this._input,this._cursor))&&this.setCursor(e);break;case"f":i=this._input,n=this._cursor,null!=(e=null==(u=a(i,!1).find((function(t){return t>n})))?i.length:u)&&this.setCursor(e);break;case"":null!=(e=h(this._input,this._cursor))&&(this.setInput(this._input.substring(0,e)+this._input.substring(this._cursor)),this.setCursor(e))}else if(l<32||127===l)switch(t){case"\r":!function(t){return""!=t.trim()&&((t.match(/'/g)||[]).length%2!=0||(t.match(/"/g)||[]).length%2!=0||""==t.split(/(\|\||\||&&)/g).pop().trim()||!(!t.endsWith("\\")||t.endsWith("\\\\")))}(this._input)?this.handleReadComplete():this.handleCursorInsert("\n");break;case"":this.handleCursorErase(!0);break;case"\t":if(this._autocompleteHandlers.length>0){var d=this._input.substring(0,this._cursor),y=f(d),g=function(t,r){var e=(0,s.parse)(r),i=e.length-1,n=e[i]||"";return""===r.trim()?(i=0,n=""):f(r)&&(i+=1,n=""),t.reduce((function(t,r){var n,s=r.fn,u=r.args;try{return t.concat(s.apply(void 0,[i,e].concat(function(t){if(Array.isArray(t))return o(t)}(n=u)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,r){if(t){if("string"==typeof t)return o(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,r):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())))}catch(r){return console.error("Auto-complete error:",r),t}}),[]).filter((function(t){return t.startsWith(n)}))}(this._autocompleteHandlers,d);if(g.sort(),0===g.length)y||this.handleCursorInsert(" ");else if(1===g.length){var _=v(d);this.handleCursorInsert(g[0].substring(_.length)+" ")}else if(g.length<=this.maxAutocompleteEntries){var b=m(d,g);if(b){var w=v(d);this.handleCursorInsert(b.substring(w.length))}this.printAndRestartPrompt((function(){r.printWide(g)}))}else this.printAndRestartPrompt((function(){return r.readChar("Display all ".concat(g.length," possibilities? (y or n)")).then((function(t){"y"!=t&&"Y"!=t||r.printWide(g)}))}))}else this.handleCursorInsert("    ");break;case"":this.setCursor(this._input.length),this.term.write("^C\r\n"+((this._activePrompt||{}).prompt||"")),this._input="",this._cursor=0,this.history&&this.history.rewind()}else this.handleCursorInsert(t)}}}],e&&y(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),t}();const _=g})(),LocalEchoController=i.default})();
//# sourceMappingURL=local-echo.js.map